Using Sessions

Refactor the application to support sessions